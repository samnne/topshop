<% layout("layout/boilerplate") %>

<%if(currentUser && collections.length) {%>
<main class="flex-col px-5 h-[80dvh]  overflow-auto">
 


  <ul class=" grid sm:grid-cols-2 lg:grid-cols-3  grid-cols-1  rounded-2xl gap-2  relative" id="list-group">
    <% for(let collection of collections){ %>
    <li id="<%= collection._id %>Root" class="group bg-white flex rounded-2xl flex-col   drop-shadow-textMain-500 drop-shadow-lg   relative z-5 hover:rotate-x-12 active:bg-accent-500 transition-all
    duration-300 ease-in-out text-4xl h-fit p-4 w-full md:max-w-sm  text-textMain-800 <%= collection.products[0] === undefined ? " hidden" : ""
              %>">
      <a role="button" data-id="<%=collection._id%>" aria-expanded="false" aria-controls="collapseExample<%= collection._id %>" class=" cursor-pointer flex-2 collapse-toggle">
        
        <header class="flex  flex-col font-light">
          
          <h1 class="flex items-center text-lg gap-2 font-semibold ">
            <i class="fa-solid  text-secondary-500 bg-accent-500 p-4 rounded-full   <%= icons.find(icon => icon.name === collection.name).icon %>"></i>
            
            <div class="flex flex-col ">
              <%= collection.name.toUpperCase() %>
              <small class="text-sm font-light">
                <%= collection.products.length %> items
              </small>

            </div>
            <span class="text-xs transition-all duration-100 group-hover:opacity-100 opacity-0 font-extralight">Click to see preview!</spa>
          </h1>
        

        </header>
        <div class=" text-end  flex gap-2 m-0 items-center">
          <a href="/products?category=<%= collection.name%>" role="button" class="active:text-background-500">
            <i class="fa-solid fa-eye"></i>
          </a>
          <button class="original-button-two scale-75 opacity-100 transition-all" id="Hey<%= collection._id %>" data-id="<%= collection._id %>">
            <i class="fa-solid fa-x"></i>
          </button>
          <form class="hidden opacity-0 scale-75 transition-all" id="<%= collection._id %>" action="/categories/deleteAll/<%= collection._id %>?_method=DELETE" method="post">
            <button>
              <i class="fa-solid fa-trash"></i>
            </button>
          </form>
        </div>
      </a>
      <ul class="overflow-hidden  md:top-32 md:left-0  z-10 text-lg w-full  rounded-2xl max-h-0 transition-all first:rounded-t-2xl last:rounded-b-2xl  duration-300 ease-in-out" id="collapseExample<%= collection._id %>">
        <% for(let product of collection.products){ %>
        <% if (product.category===collection.name){ %>
  
        <li class="flex flex-wrap text-textMain-900 h-full  bg-secondary-200 hover:bg-textMain-400 justify-between">
          <div class=" p-2 ps-4 w-[100%]">
            <a class="" href="/products/<%= product.id %>">
              <b class="hover:text-background-100">
                <%= product.name %>:
              </b>
            </a>
            <span>
              $<%= displayPrice(product.price) %>
            </span>
            <span class="<%= product.buy === " on" ? "font-bold" : "font-light" %> ">
              <%= product.qty %> : <%= product.buy==="on" ? "Buy" : "Dont Buy" %>
            </span>
          </div>
          <div class="  flex p-2 justify-end w-[100%]">
            <div class="flex gap-1">
              <a href="/products/new/<%= product.id %>/edit" class="btn-edit">Edit</a>
              <form action="/products/<%= product._id %>?_method=DELETE" id="<%= product._id %>" class=" p-0 peer-checked:block hidden fs-6 input-group-text" method="post">
                <button class="btn-delete">
                  Delete
                </button>
              </form>
              <button class="btn-delete peer original-button" id="Hey<%= product._id %>" aria-controls="<%= product._id %>" data-id="<%= product._id %>">
                Delete?
              </button>
            </div>
          </div>
        </li>
  
  
  
        <% } %>
        <% } %>
      </ul>
    </li>
    <% } %>
  </ul>


  <% }else if (currentUser && !collections.length){ %>
  <section class="flex flex-col justify-center items-center gap-4 h-screen   text-shadow-white">
    <p class="text-center text-4xl">Create a new product to get started!</p>
    <a href="/products/new" class="btn-success mt-4">Create Product</a>
  </section>
</main>
<% } else { %>




<%- include('../partials/landingpage.ejs') %>


<% } %>


<script defer src="/js/deleteButton.js">
</script>
<!-- <script src="/js/searchBar.js">

</script> -->