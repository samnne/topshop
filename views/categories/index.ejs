<% layout("layout/boilerplate") %>
  <main class="flex-col px-5">
       <%if(currentUser) {%>
    <header class="mb-5 text-shadow-xs text-shadow-white">
      <h1 class=" sm:text-6xl text-4xl text-center text-shadow">Your Categories</h1>
    </header>
 
    

    <ul class="flex flex-col sm:w-auto lg:w-[50rem] rounded-2xl gap-2  relative" id="list-group">
      <% for(let collection of collections){ %>
        <li class="bg-primary-300 flex rounded-2xl  drop-shadow-textMain-500 drop-shadow-lg relative z-5 hover:rotate-x-12 active:bg-primary-500 transition-all
    duration-300 ease-in-out text-4xl p-4 text-textMain-800 <%= collection.products[0] === undefined ? "hidden"
            : "" %>">
        <a role="button" data-id="<%=collection._id%>" aria-expanded="false" aria-controls="collapseExample<%= collection._id %>"
           class="peer cursor-pointer flex-2 collapse-toggle">
          
            <h1 class="flex flex-col font-light">
              <%= collection.name.toUpperCase() %>
                
                <small class="text-lg">
                  <%= collection.products.length %> items
                </small>
            </h1>
            <div class=" text-end  flex flex-col m-0 items-center">
              <a href="/products?category=<%= collection.name%>" role="button" class="active:text-background-500">
                <i class="fa-solid fa-eye"></i>
              </a>
              <button class="original-button-two scale-75 opacity-100 transition-all" id="Hey<%= collection._id %>" data-id="<%= collection._id %>">
                <i class="fa-solid fa-x"></i>
              </button>
              <form class="hidden opacity-0 scale-75 transition-all" id="<%= collection._id %>" action="/categories/deleteAll/<%= collection._id %>?_method=DELETE" method="post">
                <button >
                  <i class="fa-solid fa-trash"></i>
                </button>
              </form>
            </div>
        </a>
      </li>
        <div class="overflow-hidden relative z-10  rounded-2xl max-h-0 transition-all first:rounded-t-2xl last:rounded-b-2xl peer-checked:max-h-full duration-300 ease-in-out"
          id="collapseExample<%= collection._id %>">
          <% for(let product of collection.products){ %>
            <% if (product.category===collection.name){ %>

              <li class="flex flex-wrap text-textMain-900 h-full  bg-secondary-200 hover:bg-textMain-400 justify-between">
                <div class=" p-2 ps-4 w-[100%]">
                  <a class="" href="/products/<%= product.id %>">
                    <b class="hover:text-background-100">
                      <%= product.name %>:
                    </b>
                  </a>
                  <span>
                    $<%= displayPrice(product.price) %>
                  </span>
                  <span class="<%= product.buy === " on" ? "font-bold" : "font-light" %> ">
                    <%= product.qty %> : <%= product.buy==="on" ? "Buy" : "Dont Buy" %>
                  </span>
                </div>
                <div class="  flex p-2 justify-end w-[100%]">
                  <div class="flex gap-1">
                    <a href="/products/new/<%= product.id %>/edit" class="btn-edit">Edit</a>


                    <form action="/products/<%= product._id %>?_method=DELETE" id="<%= product._id %>" class=" p-0 peer-checked:block hidden fs-6 input-group-text"
                      method="post">
                      <button class="btn-delete">
                        Delete
                      </button>
                    </form>
                    <button class="btn-delete peer original-button" id="Hey<%= product._id %>" aria-controls="<%= product._id %>" data-id="<%= product._id %>" >
                        Delete?
                    </button>
                  </div>
                </div>
              </li>
              


              <% } %>
            <% } %>
        </div>
        <% } %>
    </ul>

   
    <% }else if (currentUser && collections.length === 0){ %>
      <section class="flex flex-col justify-center items-center gap-4 h-screen   text-shadow-white">
        <p class="text-center">Create a new product to get started!</p>
        <a href="/products/new" class="btn-success mt-4">Create Product</a>
      </section>
      <% } else { %>
          <header class="h-[80dvh] w-full min-sm:text-5xl max-sm:text-2xl flex gap-5 flex-col items-center justify-center main-text" >
          <h1 style="text-shadow: 4px 2px 10px rgba(255, 255, 255, 0.596);">TopShop</h1>
          <h1 class="text-center" style="text-shadow: 4px 2px 10px rgba(255, 255, 255, 0.596);">Sign Up to never be surprised again!</h1>
          <div>
            <a role="button" href="/register"  class="btn-success min-sm:text-2xl">Sign Up</a>
            <a role="button" href="/login" class="btn-edit min-sm:text-2xl">Log in</a>
          </div> 
        </header>

        <% } %>
  </main>

    <script defer src="/js/deleteButton.js">
    </script>